services:
  ignition-dev:
    image: inductiveautomation/ignition:8.1.42
    container_name: ignition-dev
    ports:
      - "{{ http_port }}:8088"
      - "{{ https_port }}:8043"
    volumes:
      # Always mount the data volume (read/write)
      - ign-data:/usr/local/bin/ignition/data

      {% if mode == 'backup' %}
      # In backup mode, mount only the gateway backup
      - ./backups/{{ backup_file }}:/restore.gwbk:ro
      {% else %}
      # In clean mode, mount your entire projects folder so Ignition can scan and create .resources
      - ./projects:/usr/local/bin/ignition/data/projects
      {% endif %}

      {% if tag_file %}
      # Tag import (optional) stays the same
      - ./tags/{{ tag_file }}:/usr/local/bin/ignition/data/init-tags.json:ro
      {% endif %}
    environment:
      - ACCEPT_IGNITION_EULA=Y
      - GATEWAY_ADMIN_USERNAME={{ admin_user }}
      - GATEWAY_ADMIN_PASSWORD={{ admin_pass }}
      - IGNITION_EDITION={{ edition }}
      - TZ={{ timezone }}
    command:
      - -n
      - {{ gateway_name }}
      {% if mode == 'backup' %}
      - -r
      - /restore.gwbk
      {% endif %}
volumes:
  ign-data:

